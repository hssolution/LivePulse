# 🏗️ 세션 관리 시스템 아키텍처

## 📋 시스템 개요

실시간 세미나/강연 관리 시스템으로, 참가자 등록부터 Q&A, 설문, 송출까지 전체 프로세스를 지원합니다.

---

## 🎯 핵심 개념

### 1. **템플릿 시스템**

세션은 3가지 템플릿을 사용하여 화면을 구성합니다:

#### 📄 **메인 템플릿** (`template_id`)
- **용도**: 세션 참가 신청 화면 (`/join/:code`)
- **역할**: 참가자가 처음 보는 화면의 디자인
- **포함 요소**: 
  - 세션 정보 표시
  - 참가 신청 폼
  - 참가하기 버튼
- **필수**: ✅ 반드시 선택해야 함

#### 💬 **Q&A 템플릿** (`qna_template_id`)
- **용도**: Q&A 탭 화면 (`/live/:code` → Q&A 탭)
- **역할**: 질문 등록 및 목록 화면의 디자인
- **포함 요소**:
  - 질문 등록 폼
  - 내 질문 목록
  - 질문 상태 표시
- **선택**: ⚠️ 선택하지 않으면 메인 템플릿 사용

#### 📊 **설문 템플릿** (`poll_template_id`)
- **용도**: 설문 탭 화면 (`/live/:code` → 설문 탭)
- **역할**: 설문 참여 화면의 디자인
- **포함 요소**:
  - 설문 목록
  - 투표 폼
  - 결과 그래프
- **선택**: ⚠️ 선택하지 않으면 메인 템플릿 사용

---

## 🗺️ 화면 구조

### 1. **참가자 플로우**

```
1️⃣ 참가 신청 화면 (/join/:code)
   ↓ [메인 템플릿 적용]
   - 세션 정보 확인
   - 참가 신청 (로그인 or 익명)
   - QR 코드 스캔
   ↓
   
2️⃣ 실시간 참여 화면 (/live/:code)
   ├─ 📑 Q&A 탭 [Q&A 템플릿 or 메인 템플릿]
   │  - 질문 등록
   │  - 내 질문 목록
   │  - 답변 확인
   │
   ├─ 📊 설문 탭 [설문 템플릿 or 메인 템플릿]
   │  - 활성 설문 목록
   │  - 투표하기
   │  - 결과 확인
   │
   └─ ℹ️ 정보 탭
      - 세션 상세 정보
      - 강연자 정보
      - 일정 및 장소
```

### 2. **좌장/강연자 플로우**

```
3️⃣ 좌장 선택 화면 (/presenter/:code)
   - 질문 목록 확인
   - 송출할 질문 선택
   - 클릭으로 즉시 송출
   ↓
   
4️⃣ 송출 화면 (/broadcast/:code)
   - 대형 스크린/프로젝터용
   - 선택된 질문 전체 화면 표시
   - 실시간 스타일 설정
```

### 3. **관리자/파트너 플로우**

```
5️⃣ 세션 관리 화면
   ├─ 기본 정보 탭
   │  - 세션명, 일시, 장소
   │  - 연락처, 최대 참여자
   │
   ├─ 디자인 탭 ⭐ 중요!
   │  ├─ 메인 템플릿 선택 (필수)
   │  ├─ Q&A 템플릿 선택 (선택)
   │  └─ 설문 템플릿 선택 (선택)
   │
   ├─ Q&A 관리 탭
   │  - 질문 등록/수정/삭제
   │  - 답변 작성
   │
   ├─ 설문 관리 탭
   │  - 설문 생성/수정/삭제
   │  - 선택지 관리
   │  - 활성화/비활성화
   │
   ├─ 협업 탭
   │  - 협업 파트너 초대
   │  - 강연자 추가
   │
   └─ 참가자 관리 탭
      - 참가자 목록
      - 통계 및 분석
```

---

## 🎨 디자인 탭 상세 설명

### **왜 3개의 템플릿이 필요한가?**

각 화면은 **목적과 사용자가 다르기** 때문입니다:

| 템플릿 | 화면 | 사용자 | 목적 |
|--------|------|--------|------|
| **메인** | `/join/:code` | 처음 방문자 | 세션 소개 및 참가 유도 |
| **Q&A** | `/live/:code` Q&A 탭 | 참가자 | 질문 등록 및 관리 |
| **설문** | `/live/:code` 설문 탭 | 참가자 | 설문 참여 및 결과 확인 |

### **템플릿 선택 방법**

#### 1️⃣ **메인 템플릿** (필수)
```
세션 관리 → 디자인 탭 → "메인 템플릿" 선택
```
- 참가 신청 화면의 전체 디자인을 결정
- 반드시 선택해야 함
- 예: "컨퍼런스형", "워크샵형", "세미나형"

#### 2️⃣ **Q&A 템플릿** (선택)
```
세션 관리 → 디자인 탭 → "Q&A 템플릿" 선택
```
- **선택 안 함**: 메인 템플릿의 디자인 사용
- **선택함**: Q&A 전용 디자인 사용
- 예: "심플 Q&A", "카드형 Q&A", "리스트형 Q&A"

#### 3️⃣ **설문 템플릿** (선택)
```
세션 관리 → 디자인 탭 → "설문 템플릿" 선택
```
- **선택 안 함**: 메인 템플릿의 디자인 사용
- **선택함**: 설문 전용 디자인 사용
- 예: "바 차트형", "파이 차트형", "실시간 투표"

---

## 🔄 데이터 흐름

### 1. **참가자 등록**
```
참가자 → /join/:code → 참가 신청
  ↓
session_members (회원) or anonymous_participants (비회원)
  ↓
participant_count 증가
```

### 2. **Q&A 등록**
```
참가자 → /live/:code → Q&A 탭 → 질문 등록
  ↓
questions 테이블에 저장 (status: pending)
  ↓
좌장 → /presenter/:code → 질문 선택
  ↓
is_broadcasting = true 설정
  ↓
송출 화면 → /broadcast/:code → 질문 표시
```

### 3. **설문 참여**
```
관리자/파트너 → 설문 생성 (status: draft)
  ↓
설문 활성화 (status: active)
  ↓
참가자 → /live/:code → 설문 탭 → 투표
  ↓
poll_responses 테이블에 저장
  ↓
votes 증가 (RPC: increment_poll_option_votes)
  ↓
실시간 결과 표시
```

---

## 📊 데이터베이스 스키마

### 핵심 테이블

```sql
-- 세션
sessions
  ├─ id (UUID)
  ├─ code (참여 코드)
  ├─ template_id (메인 템플릿)
  ├─ qna_template_id (Q&A 템플릿, nullable)
  ├─ poll_template_id (설문 템플릿, nullable)
  ├─ participant_count (참가자 수)
  └─ status (draft/active/ended)

-- 템플릿
session_templates
  ├─ id (UUID)
  ├─ name (템플릿 이름)
  ├─ screen_type (main/qna/poll)
  └─ is_active (활성 여부)

-- 참가자 (회원)
session_members
  ├─ session_id
  ├─ user_id
  └─ created_at

-- 참가자 (비회원)
anonymous_participants
  ├─ session_id
  ├─ name, email, phone
  └─ created_at

-- Q&A
questions
  ├─ session_id
  ├─ user_id
  ├─ question (질문 내용)
  ├─ answer (답변)
  ├─ status (pending/selected/answered)
  └─ is_broadcasting (송출 중 여부)

-- 설문
polls
  ├─ session_id
  ├─ question (설문 질문)
  └─ status (draft/active/ended)

poll_options
  ├─ poll_id
  ├─ option_text (선택지)
  └─ votes (투표 수)

poll_responses
  ├─ poll_id
  ├─ option_id
  └─ user_id
```

---

## 🎯 사용 시나리오

### 시나리오 1: 기본 세미나 (메인 템플릿만 사용)

```
1. 파트너가 세션 생성
   - 메인 템플릿: "컨퍼런스형" 선택
   - Q&A 템플릿: 선택 안 함 (메인 템플릿 사용)
   - 설문 템플릿: 선택 안 함 (메인 템플릿 사용)

2. 참가자가 QR 코드로 접속
   - /join/:code → "컨퍼런스형" 디자인으로 표시
   - 참가 신청 완료

3. 참가자가 실시간 참여
   - /live/:code
   - Q&A 탭 → "컨퍼런스형" 디자인
   - 설문 탭 → "컨퍼런스형" 디자인
```

### 시나리오 2: 고급 세미나 (각각 다른 템플릿 사용)

```
1. 파트너가 세션 생성
   - 메인 템플릿: "워크샵형" 선택
   - Q&A 템플릿: "카드형 Q&A" 선택
   - 설문 템플릿: "실시간 투표" 선택

2. 참가자가 접속
   - /join/:code → "워크샵형" 디자인
   - 참가 신청 완료

3. 참가자가 실시간 참여
   - /live/:code
   - Q&A 탭 → "카드형 Q&A" 디자인
   - 설문 탭 → "실시간 투표" 디자인
```

---

## 🚀 핵심 기능

### 1. **실시간 동기화**
- Supabase Realtime 사용
- 질문 등록 즉시 반영
- 설문 결과 실시간 업데이트
- 송출 화면 자동 갱신

### 2. **권한 관리**
- Row Level Security (RLS)
- 세션 소유자만 수정 가능
- 협업 파트너 초대 시스템
- 강연자 권한 관리

### 3. **템플릿 시스템**
- 화면별 독립적인 디자인
- 재사용 가능한 컴포넌트
- 동적 필드 렌더링
- 실시간 미리보기

### 4. **통계 및 분석**
- 참가자 통계 (일별, 시간대별, 요일별)
- Q&A 통계
- 설문 결과 분석
- 실시간 대시보드

---

## 🎨 UI/UX 특징

### 참가자 화면
- 모바일 최적화
- 직관적인 탭 구조
- 실시간 피드백
- 접근성 고려

### 관리자 화면
- 분할 레이아웃 (설정 + 미리보기)
- 드래그로 크기 조절
- 디바이스별 미리보기
- 즉시 저장

### 송출 화면
- 전체 화면 최적화
- 커스터마이징 가능
- 폰트, 색상, 정렬 설정
- 권한자만 설정 패널 접근

---

## 📝 개발자 가이드

### 새 템플릿 추가 방법

1. **템플릿 생성**
```sql
INSERT INTO session_templates (name, screen_type, description)
VALUES ('새 템플릿', 'main', '설명');
```

2. **필드 정의**
```sql
INSERT INTO session_template_fields (template_id, field_name, field_type, ...)
VALUES (...);
```

3. **컴포넌트 구현**
```jsx
// src/components/template/[TemplateName].jsx
export default function NewTemplate({ data }) {
  return <div>...</div>
}
```

### 새 화면 타입 추가 방법

1. `screen_type` enum에 추가
2. 라우팅 설정
3. 템플릿 선택 UI 추가
4. 렌더링 로직 구현

---

## ✅ 체크리스트

### 세션 생성 시
- [ ] 메인 템플릿 선택 (필수)
- [ ] Q&A 템플릿 선택 (선택)
- [ ] 설문 템플릿 선택 (선택)
- [ ] 세션 정보 입력
- [ ] 상태를 'active'로 변경

### 세션 진행 시
- [ ] 참가자 등록 확인
- [ ] Q&A 모니터링
- [ ] 설문 활성화
- [ ] 좌장 화면 준비
- [ ] 송출 화면 설정

### 세션 종료 후
- [ ] 참가자 통계 확인
- [ ] Q&A 답변 완료
- [ ] 설문 결과 분석
- [ ] 세션 상태를 'ended'로 변경

---

## 🎊 결론

이 시스템은 **템플릿 기반**으로 설계되어, 각 화면을 독립적으로 디자인할 수 있습니다.

- **메인 템플릿**: 참가 신청 화면
- **Q&A 템플릿**: Q&A 탭 (선택사항)
- **설문 템플릿**: 설문 탭 (선택사항)

모든 화면은 `/live/:code` 내에서 **탭으로 전환**되며, 실시간으로 동기화됩니다! 🚀

