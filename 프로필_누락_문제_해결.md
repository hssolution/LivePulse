# 🔧 프로필 정보 누락 문제 해결

## 문제 상황

JWT 디코딩 결과:
```javascript
{
  email: "lhscj246b@gmail.com",
  role: "authenticated",
  status: undefined,
  userType: undefined,
  description: undefined
}
```

**이메일만 있고 나머지 프로필 정보가 없음!**

---

## 원인 분석

### 1. profiles 테이블에 데이터가 없었음
- Auth Hook은 `profiles` 테이블에서 정보를 조회
- 해당 사용자의 프로필 레코드가 없으면 기본값만 반환
- 트리거는 존재하지만, **이미 가입한 사용자**에 대해서는 실행 안됨

### 2. 트리거 작동 시점
```sql
create trigger on_auth_user_created
  after insert on auth.users  -- INSERT 시에만 실행!
```

- 트리거는 **새로 가입하는 사용자**에게만 작동
- 트리거 생성 전에 가입한 사용자는 프로필이 없음

---

## 해결 방법

### ✅ 해결 완료: 기존 사용자 프로필 생성

```sql
-- 기존 사용자의 프로필 수동 생성
INSERT INTO public.profiles (id, email, role, user_type, status, description)
VALUES (
  'b2019fe5-e8b8-4552-aad2-dbbcf0202bce',
  'lhscj2466@gmail.com',
  'admin',
  'admin',
  'active',
  '시스템 관리자'
);
```

### 생성된 프로필 정보

| 필드 | 값 |
|------|-----|
| email | lhscj2466@gmail.com |
| role | admin |
| user_type | admin |
| status | active |
| description | 시스템 관리자 |

---

## 다음 단계

### 1. 로그아웃 후 재로그인 ⚠️

**중요**: 프로필을 생성했으니 이제 **로그아웃 후 다시 로그인**해야 합니다!

```
1. 현재 로그아웃
2. 다시 로그인
3. JWT 토큰이 새로 발급되면서 프로필 정보 포함됨
```

### 2. 확인 방법

로그인 후 브라우저 콘솔에서:

```javascript
// AuthContext가 자동으로 출력하는 로그 확인
// 다음과 같이 표시되어야 함:
{
  email: "lhscj2466@gmail.com",
  role: "admin",
  userType: "admin", 
  status: "active",
  description: "시스템 관리자"
}
```

또는 `/adm/profile-test` 페이지 방문하여 확인!

---

## 향후 예방

### 새로운 사용자는 자동 생성됨

이제부터 회원가입하는 사용자는 자동으로 프로필이 생성됩니다:

```sql
-- 트리거가 자동으로 실행
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();
```

### 첫 사용자 vs 파트너

- **첫 사용자**: role='admin', user_type='admin', status='active'
- **이후 사용자**: role='user', user_type='partner', status='pending'

---

## 문제 해결 체크리스트

- [x] profiles 테이블에 데이터 없음 확인
- [x] 트리거 존재 확인
- [x] 기존 사용자 프로필 수동 생성
- [x] app_config 초기화 표시
- [ ] **로그아웃 후 재로그인** ⚠️ (사용자가 해야 함)
- [ ] JWT에 프로필 정보 포함 확인

---

## 요약

**문제**: 트리거 생성 전에 가입한 사용자는 프로필이 없음  
**해결**: 수동으로 프로필 생성 완료  
**다음**: 로그아웃 후 재로그인하면 모든 정보가 JWT에 포함됨! 🎉

